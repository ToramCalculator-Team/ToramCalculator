# ToramCalculator

## ğŸ“– é¡¹ç›®ç®€ä»‹

ToramCalculator æ˜¯ä¸€ä¸ªä¸º Toram Online æ¸¸æˆå¼€å‘çš„è¾…åŠ©å·¥å…·ã€‚é€šè¿‡æ¨¡æ‹Ÿæˆ˜æ–—è¿‡ç¨‹ï¼Œå¸®åŠ©ç©å®¶æ‰¾åˆ°æœ€ä¼˜çš„é…ç½®æ–¹æ¡ˆã€‚

### âœ¨ æ ¸å¿ƒåŠŸèƒ½

- ğŸ® é˜Ÿä¼é…ç½®ä¼˜åŒ–
- âš”ï¸ æˆ˜æ–—è¿‡ç¨‹æ¨¡æ‹Ÿ
- ğŸ“Š é€å¸§æ•°æ®åˆ†æ
- ğŸ“ˆ æ•°æ®å¯è§†åŒ–å±•ç¤º
- ğŸ”— é…ç½®åˆ†äº«åŠŸèƒ½
- ğŸ“š å†…ç½®æ¸¸æˆ Wiki åº“
- ğŸ¯ å®æ—¶æˆ˜æ–—æ¨¡æ‹Ÿå™¨
- ğŸ”„ å·¥ä½œæµç¼–è¾‘å™¨
- ğŸ¨ 3D åœºæ™¯æ¸²æŸ“

### ğŸŒ é¡¹ç›®åœ°å€

ğŸ”— [https://app.kiaclouth.com](https://app.kiaclouth.com)

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### 1. UI å±‚ (Presentation Layer)
- **æŠ€æœ¯æ ˆ**: SolidJS, Tailwind CSS, Babylon.js, Editor.js, TanStack (Form/Table/Virtual), OverlayScrollbars
- **èŒè´£**: ç”¨æˆ·ç•Œé¢å±•ç¤ºã€äº¤äº’å¤„ç†ã€åŠ¨ç”»æ•ˆæœã€3Dæ¸²æŸ“ã€è¡¨å•ç®¡ç†

### 2. åº”ç”¨é€»è¾‘å±‚ (Application Layer)
- **æŠ€æœ¯æ ˆ**: XState, SolidJS Primitives, Solid Motion, Sequential Workflow Designer
- **èŒè´£**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€çŠ¶æ€ç®¡ç†ã€æ¨¡æ‹Ÿå™¨è®¡ç®—ã€å·¥ä½œæµç®¡ç†ã€åŠ¨ç”»æ§åˆ¶

### 3. æ¨¡æ‹Ÿå™¨å¼•æ“å±‚ (Simulator Engine Layer)
- **æŠ€æœ¯æ ˆ**: Web Workers, XState, Comlink, MathJS, äº‹ä»¶é©±åŠ¨æ¶æ„
- **èŒè´£**: æˆ˜æ–—æ¨¡æ‹Ÿã€å¸§å¾ªç¯ã€äº‹ä»¶é˜Ÿåˆ—ã€çŠ¶æ€æœºç®¡ç†ã€æ•°å­¦è®¡ç®—

### 4. æ•°æ®å±‚ (Data Layer)
- **æŠ€æœ¯æ ˆ**: PGLite, Kysely, ElectricSQL, PostgreSQL, Zod, Prisma
- **èŒè´£**: æ•°æ®è®¿é—®ã€å­˜å‚¨ç®¡ç†ã€æ•°æ®åŒæ­¥ã€æ•°æ®éªŒè¯ã€ORMç®¡ç†

### 5. è®¤è¯ä¸å®‰å…¨å±‚ (Authentication & Security Layer)
- **æŠ€æœ¯æ ˆ**: Auth.js, JOSE, bcrypt, js-cookie
- **èŒè´£**: ç”¨æˆ·è®¤è¯ã€JWTå¤„ç†ã€å¯†ç åŠ å¯†ã€ä¼šè¯ç®¡ç†

### 6. åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)
- **æŠ€æœ¯æ ˆ**: CUID2, Vinxi, Hotkeys.js, Lodash, dotenv
- **èŒè´£**: IDç”Ÿæˆã€æ„å»ºå·¥å…·ã€å¿«æ·é”®å¤„ç†ã€å·¥å…·å‡½æ•°ã€ç¯å¢ƒé…ç½®

## ğŸ“ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ .husky/                    # Git hooks é…ç½®
â”œâ”€â”€ backend/                   # åç«¯æœåŠ¡é…ç½® (Docker)
â”œâ”€â”€ db/                        # æ•°æ®åº“ç›¸å…³
â”‚   â”œâ”€â”€ backups/              # æ•°æ®åº“å¤‡ä»½
â”‚   â”œâ”€â”€ generated/            # è‡ªåŠ¨ç”Ÿæˆçš„ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ generators/           # ä»£ç ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ repositories/         # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ schema/               # æ•°æ®åº“æ¶æ„å®šä¹‰
â”‚   â””â”€â”€ scripts/              # æ•°æ®åº“è„šæœ¬
â”œâ”€â”€ public/                    # é™æ€èµ„æº
â””â”€â”€ src/                       # åº”ç”¨é€»è¾‘æºä»£ç 
    â”œâ”€â”€ components/            # UI ç»„ä»¶
    â”‚   â”œâ”€â”€ containers/        # å®¹å™¨ç»„ä»¶
    â”‚   â”œâ”€â”€ controls/          # æ§ä»¶ç»„ä»¶
    â”‚   â”œâ”€â”€ dataDisplay/       # æ•°æ®å±•ç¤ºç»„ä»¶
    â”‚   â”œâ”€â”€ effects/           # ç‰¹æ•ˆç»„ä»¶
    â”‚   â”œâ”€â”€ features/          # åŠŸèƒ½ç‰¹æ€§ç»„ä»¶
    â”‚   â”‚   â”œâ”€â”€ simulator/     # æ¨¡æ‹Ÿå™¨ç›¸å…³
    â”‚   â”‚   â”‚   â”œâ”€â”€ controller/  # æ§åˆ¶å™¨
    â”‚   â”‚   â”‚   â”œâ”€â”€ core/        # æ ¸å¿ƒå¼•æ“
    â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/    # äº‹ä»¶å¤„ç†å™¨
    â”‚   â”‚   â”‚   â””â”€â”€ legacy/      # æ—§ç‰ˆæœ¬å…¼å®¹
    â”‚   â”‚   â”œâ”€â”€ flowEditor/    # å·¥ä½œæµç¼–è¾‘å™¨
    â”‚   â”‚   â”œâ”€â”€ nodeEditor/    # èŠ‚ç‚¹ç¼–è¾‘å™¨
    â”‚   â”‚   â””â”€â”€ logicEditor/   # é€»è¾‘ç¼–è¾‘å™¨
    â”‚   â””â”€â”€ icons/             # å›¾æ ‡ç»„ä»¶
    â”œâ”€â”€ lib/                   # æ ¸å¿ƒåº“
    â”‚   â”œâ”€â”€ contexts/          # SolidJS Context
    â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
    â”œâ”€â”€ locales/               # å›½é™…åŒ–æ–‡ä»¶
    â”œâ”€â”€ routes/                # åº”ç”¨è·¯ç”±
    â”œâ”€â”€ styles/                # æ ·å¼æ–‡ä»¶
    â””â”€â”€ worker/                # Web Workers
```

## ğŸ“ Commit è§„èŒƒ

æäº¤ä¿¡æ¯æ ¼å¼ï¼š`type(scope): subject`

### ç±»å‹è¯´æ˜

| ç±»å‹ | è¯´æ˜ |
|------|------|
| âœ¨ feat | æ–°å¢åŠŸèƒ½ |
| ğŸ› fix | bug ä¿®å¤ |
| ğŸ“ docs | æ–‡æ¡£æ›´æ–° |
| ğŸ’„ style | ä»£ç æ ¼å¼ä¿®æ”¹ï¼ˆä¸å½±å“é€»è¾‘ï¼‰ |
| ğŸ”¨ refactor | ä»£ç é‡æ„ |
| âš¡ï¸ perf | æ€§èƒ½ä¼˜åŒ– |
| âœ… test | æµ‹è¯•ç›¸å…³ |
| ğŸ“¦ build | æ„å»ºç³»ç»Ÿä¿®æ”¹ |
| ğŸ”§ ci | CI é…ç½®ä¿®æ”¹ |
| ğŸ« chore | å…¶ä»–ä¿®æ”¹ |
| âª revert | å›æ»šæäº¤ |

## ğŸš€ å¼€å‘æŒ‡å—

### ç¯å¢ƒè¦æ±‚
- ğŸ³ Docker
- ğŸ“¦ Node.js >= 20
- ğŸ”§ pnpm >= 9.15.2
- âš¡ tsx (å…¨å±€å®‰è£…)

### å…¨å±€å®‰è£… tsx

åœ¨å¼€å§‹å¼€å‘ä¹‹å‰ï¼Œéœ€è¦å…¨å±€å®‰è£… tsxï¼š

```bash
# ä½¿ç”¨ npm
npm install -g tsx

# æˆ–ä½¿ç”¨ pnpm
pnpm add -g tsx
```

### åˆå§‹åŒ–æµç¨‹

é¦–æ¬¡å¼€å‘æˆ–æ•°æ®æ¶æ„å˜æ›´æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. å®‰è£…ä¾èµ–
pnpm install

# 2. å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# 3. æ‰§è¡Œå®Œæ•´åˆå§‹åŒ–
pnpm dev:init
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
- ç”Ÿæˆæ‰€æœ‰å¿…è¦çš„æ•°æ®åº“æ¶æ„å’Œç±»å‹å®šä¹‰
- å¯åŠ¨ PostgreSQL æ•°æ®åº“ï¼ˆè‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ– SQLï¼‰
- å¯åŠ¨ Electric åŒæ­¥æœåŠ¡

### æ—¥å¸¸å¼€å‘æµç¨‹

æ—¥å¸¸å¼€å‘æ—¶ï¼Œåªéœ€æ‰§è¡Œï¼š

```bash
# 1. è®¾ç½®å¼€å‘ç¯å¢ƒï¼ˆå¦‚æœéœ€è¦é‡ç½®æ•°æ®ï¼‰
pnpm dev:setup

# 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

### æ•°æ®åº“æ¶æ„

é¡¹ç›®ä½¿ç”¨ä¸¤ä¸ªæ•°æ®åº“ï¼š
1. æœåŠ¡ç«¯æ•°æ®åº“ï¼ˆPostgreSQLï¼‰
   - ä½¿ç”¨ `db/baseSchema.prisma` ä½œä¸ºåŸºç¡€æ¶æ„å®šä¹‰
   - é€šè¿‡ Docker è‡ªåŠ¨åˆå§‹åŒ–
   - ä½¿ç”¨ Electric è¿›è¡Œæ•°æ®åŒæ­¥

2. å®¢æˆ·ç«¯æ•°æ®åº“ï¼ˆPGLiteï¼‰
   - åŸºäºæœåŠ¡ç«¯æ¶æ„ç”Ÿæˆ
   - æ”¯æŒæœ¬åœ°å†™å…¥å’Œæ•°æ®åŒæ­¥
   - ä½¿ç”¨è§†å›¾åˆå¹¶æœ¬åœ°å’ŒåŒæ­¥æ•°æ®

### ç±»å‹ç³»ç»Ÿ

- æ‰€æœ‰æšä¸¾ç±»å‹å®šä¹‰åœ¨ `db/enums.ts`
- ä½¿ç”¨ `generator.js` å°†æšä¸¾æ³¨å…¥åˆ°æ•°æ®åº“æ¶æ„
- ç”Ÿæˆçš„ç±»å‹å®šä¹‰åœ¨ `db/dataEnums.ts`

### æ¨¡æ‹Ÿå™¨æ¶æ„

é¡¹ç›®åŒ…å«ä¸€ä¸ªå®Œæ•´çš„æˆ˜æ–—æ¨¡æ‹Ÿå™¨ç³»ç»Ÿï¼š

- **æ ¸å¿ƒå¼•æ“**: äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œæ”¯æŒå®æ—¶å’Œæ‰¹é‡æ¨¡æ‹Ÿ
- **çŠ¶æ€æœº**: åŸºäº XState çš„è§’è‰²çŠ¶æ€ç®¡ç†
- **å·¥ä½œæµç¼–è¾‘å™¨**: å¯è§†åŒ–çš„å·¥ä½œæµè®¾è®¡å·¥å…·
- **3D æ¸²æŸ“**: åŸºäº Babylon.js çš„æˆ˜æ–—åœºæ™¯æ¸²æŸ“

### å¼€å‘å‘½ä»¤

- `pnpm dev` - å¯åŠ¨å¼€å‘æœåŠ¡å™¨
- `pnpm dev:setup` - é‡ç½®å¹¶å¯åŠ¨å¼€å‘ç¯å¢ƒ  
- `pnpm dev:init` - åˆå§‹åŒ–å¼€å‘ç¯å¢ƒï¼ˆç”Ÿæˆæ•°æ®åº“æ¶æ„å’Œç±»å‹ï¼‰
- `pnpm backend:up` - å¯åŠ¨åç«¯æœåŠ¡ï¼ˆPostgreSQL + Electricï¼‰
- `pnpm backend:stop` - åœæ­¢åç«¯æœåŠ¡
- `pnpm backend:down` - åœæ­¢å¹¶åˆ é™¤åç«¯å®¹å™¨å’Œæ•°æ®å·
- `pnpm db:studio` - æ‰“å¼€ Prisma Studio æŸ¥çœ‹æ•°æ®åº“
- `pnpm db:backup` - å¤‡ä»½æ•°æ®åº“
- `pnpm db:restore` - æ¢å¤æ•°æ®åº“å¤‡ä»½
- `pnpm build` - æ„å»ºç”Ÿäº§ç‰ˆæœ¬
- `pnpm start` - å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
- `pnpm package` - æ‰“åŒ…åº”ç”¨ä¸º bundle.tar.gz
- `pnpm clear-build` - æ¸…ç†æ„å»ºæ–‡ä»¶

> âš ï¸ æ³¨æ„ï¼šæ¯æ¬¡ä¿®æ”¹ `db/baseSchema.prisma` æˆ– `db/enums.ts` åï¼Œéƒ½éœ€è¦é‡æ–°æ‰§è¡Œ `pnpm dev:init`ã€‚

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. æ„å»ºåº”ç”¨ï¼š
```bash
pnpm package
```

2. éƒ¨ç½²ç”Ÿæˆçš„ `bundle.tar.gz`
