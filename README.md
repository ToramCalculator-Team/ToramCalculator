# ToramCalculator

## ğŸ“– é¡¹ç›®ç®€ä»‹

ToramCalculator æ˜¯ä¸€ä¸ªä¸º Toram Online æ¸¸æˆå¼€å‘çš„è¾…åŠ©å·¥å…·ã€‚é€šè¿‡æ¨¡æ‹Ÿæˆ˜æ–—è¿‡ç¨‹ï¼Œå¸®åŠ©ç©å®¶æ‰¾åˆ°æœ€ä¼˜çš„é…ç½®æ–¹æ¡ˆã€‚

### âœ¨ æ ¸å¿ƒåŠŸèƒ½

- ğŸ® é˜Ÿä¼é…ç½®ä¼˜åŒ–
- âš”ï¸ æˆ˜æ–—è¿‡ç¨‹æ¨¡æ‹Ÿ
- ğŸ“Š é€å¸§æ•°æ®åˆ†æ
- ğŸ“ˆ æ•°æ®å¯è§†åŒ–å±•ç¤º
- ğŸ”— é…ç½®åˆ†äº«åŠŸèƒ½
- ğŸ“š å†…ç½®æ¸¸æˆ Wiki åº“
- ğŸ¯ å®æ—¶æˆ˜æ–—æ¨¡æ‹Ÿå™¨
- ğŸ”„ å·¥ä½œæµç¼–è¾‘å™¨
- ğŸ¨ 3D åœºæ™¯æ¸²æŸ“

### ğŸŒ é¡¹ç›®åœ°å€

ğŸ”— [https://app.kiaclouth.com](https://app.kiaclouth.com)

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### 1. UI å±‚ (Presentation Layer)
- **æŠ€æœ¯æ ˆ**: SolidJS, Tailwind CSS, Babylon.js, Editor.js, TanStack, OverlayScrollbars
- **èŒè´£**: ç”¨æˆ·ç•Œé¢å±•ç¤ºã€äº¤äº’å¤„ç†ã€åŠ¨ç”»æ•ˆæœã€3Dæ¸²æŸ“

### 2. åº”ç”¨é€»è¾‘å±‚ (Application Layer)
- **æŠ€æœ¯æ ˆ**: XState, SolidJS Primitives
- **èŒè´£**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€çŠ¶æ€ç®¡ç†ã€æ¨¡æ‹Ÿå™¨è®¡ç®—ã€å·¥ä½œæµç®¡ç†

### 3. æ¨¡æ‹Ÿå™¨å¼•æ“å±‚ (Simulator Engine Layer)
- **æŠ€æœ¯æ ˆ**: Web Workers, XState, äº‹ä»¶é©±åŠ¨æ¶æ„
- **èŒè´£**: æˆ˜æ–—æ¨¡æ‹Ÿã€å¸§å¾ªç¯ã€äº‹ä»¶é˜Ÿåˆ—ã€çŠ¶æ€æœºç®¡ç†

### 4. æ•°æ®å±‚ (Data Layer)
- **æŠ€æœ¯æ ˆ**: pgLite, kysely, ElectricSQL, PostgreSQL, zod
- **èŒè´£**: æ•°æ®è®¿é—®ã€å­˜å‚¨ç®¡ç†ã€æ•°æ®åŒæ­¥ã€æ•°æ®éªŒè¯

### 5. åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)
- **æŠ€æœ¯æ ˆ**: cuid2, jose, js-cookie, comlink, mathjs
- **èŒè´£**: ID ç”Ÿæˆã€JWT å¤„ç†ã€Cookie ç®¡ç†ã€Web Workersã€WASMã€æ•°å­¦è®¡ç®—

## ğŸ“ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ .husky/              # Git hooks é…ç½®
â”œâ”€â”€ backend/             # åç«¯æœåŠ¡é…ç½®
â”œâ”€â”€ db/                  # æ•°æ®åº“ç›¸å…³
â”œâ”€â”€ public/              # é™æ€èµ„æº
â”œâ”€â”€ src/                 # åº”ç”¨é€»è¾‘æºä»£ç 
â”‚   â”œâ”€â”€ components/      # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ module/      # åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ simulator/    # æ¨¡æ‹Ÿå™¨æ¨¡å—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ core/     # æ¨¡æ‹Ÿå™¨æ ¸å¿ƒå¼•æ“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/ # äº‹ä»¶å¤„ç†å™¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ test/     # æµ‹è¯•æ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ flowEditor/   # å·¥ä½œæµç¼–è¾‘å™¨
â”‚   â”‚   â”‚   â””â”€â”€ nodeEditor/   # èŠ‚ç‚¹ç¼–è¾‘å™¨
â”‚   â”‚   â””â”€â”€ ...          # å…¶ä»–ç»„ä»¶
â”‚   â”œâ”€â”€ lib/            # å·¥å…·å‡½æ•°åº“
â”‚   â”œâ”€â”€ locales/        # å›½é™…åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ repositories/   # æ•°æ®åº“äº¤äº’æ–¹æ³•
â”‚   â”œâ”€â”€ routes/         # åº”ç”¨è·¯ç”±
â”‚   â”œâ”€â”€ styles/         # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ worker/         # å·¥ä½œçº¿ç¨‹
â””â”€â”€ test/               # æµ‹è¯•æ–‡ä»¶
```

## ğŸ“ Commit è§„èŒƒ

æäº¤ä¿¡æ¯æ ¼å¼ï¼š`type(scope): subject`

### ç±»å‹è¯´æ˜

| ç±»å‹ | è¯´æ˜ |
|------|------|
| âœ¨ feat | æ–°å¢åŠŸèƒ½ |
| ğŸ› fix | bug ä¿®å¤ |
| ğŸ“ docs | æ–‡æ¡£æ›´æ–° |
| ğŸ’„ style | ä»£ç æ ¼å¼ä¿®æ”¹ï¼ˆä¸å½±å“é€»è¾‘ï¼‰ |
| ğŸ”¨ refactor | ä»£ç é‡æ„ |
| âš¡ï¸ perf | æ€§èƒ½ä¼˜åŒ– |
| âœ… test | æµ‹è¯•ç›¸å…³ |
| ğŸ“¦ build | æ„å»ºç³»ç»Ÿä¿®æ”¹ |
| ğŸ”§ ci | CI é…ç½®ä¿®æ”¹ |
| ğŸ« chore | å…¶ä»–ä¿®æ”¹ |
| âª revert | å›æ»šæäº¤ |

## ğŸš€ å¼€å‘æŒ‡å—

### ç¯å¢ƒè¦æ±‚
- ğŸ³ Docker
- ğŸ“¦ Node.js >= 20
- ğŸ”§ pnpm >= 9.15.2
- âš¡ tsx (å…¨å±€å®‰è£…)

### å…¨å±€å®‰è£… tsx

åœ¨å¼€å§‹å¼€å‘ä¹‹å‰ï¼Œéœ€è¦å…¨å±€å®‰è£… tsxï¼š

```bash
# ä½¿ç”¨ npm
npm install -g tsx

# æˆ–ä½¿ç”¨ pnpm
pnpm add -g tsx
```

### åˆå§‹åŒ–æµç¨‹

é¦–æ¬¡å¼€å‘æˆ–æ•°æ®æ¶æ„å˜æ›´æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. å®‰è£…ä¾èµ–
pnpm install

# 2. å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# 3. æ‰§è¡Œå®Œæ•´åˆå§‹åŒ–
pnpm dev:init
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
- ç”Ÿæˆæ‰€æœ‰å¿…è¦çš„æ•°æ®åº“æ¶æ„å’Œç±»å‹å®šä¹‰
- å¯åŠ¨ PostgreSQL æ•°æ®åº“ï¼ˆè‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ– SQLï¼‰
- å¯åŠ¨ Electric åŒæ­¥æœåŠ¡

### æ—¥å¸¸å¼€å‘æµç¨‹

æ—¥å¸¸å¼€å‘æ—¶ï¼Œåªéœ€æ‰§è¡Œï¼š

```bash
# 1. è®¾ç½®å¼€å‘ç¯å¢ƒï¼ˆå¦‚æœéœ€è¦é‡ç½®æ•°æ®ï¼‰
pnpm dev:setup

# 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev
```

### æ•°æ®åº“æ¶æ„

é¡¹ç›®ä½¿ç”¨ä¸¤ä¸ªæ•°æ®åº“ï¼š
1. æœåŠ¡ç«¯æ•°æ®åº“ï¼ˆPostgreSQLï¼‰
   - ä½¿ç”¨ `db/baseSchema.prisma` ä½œä¸ºåŸºç¡€æ¶æ„å®šä¹‰
   - é€šè¿‡ Docker è‡ªåŠ¨åˆå§‹åŒ–
   - ä½¿ç”¨ Electric è¿›è¡Œæ•°æ®åŒæ­¥

2. å®¢æˆ·ç«¯æ•°æ®åº“ï¼ˆPGLiteï¼‰
   - åŸºäºæœåŠ¡ç«¯æ¶æ„ç”Ÿæˆ
   - æ”¯æŒæœ¬åœ°å†™å…¥å’Œæ•°æ®åŒæ­¥
   - ä½¿ç”¨è§†å›¾åˆå¹¶æœ¬åœ°å’ŒåŒæ­¥æ•°æ®

### ç±»å‹ç³»ç»Ÿ

- æ‰€æœ‰æšä¸¾ç±»å‹å®šä¹‰åœ¨ `db/enums.ts`
- ä½¿ç”¨ `generator.js` å°†æšä¸¾æ³¨å…¥åˆ°æ•°æ®åº“æ¶æ„
- ç”Ÿæˆçš„ç±»å‹å®šä¹‰åœ¨ `db/dataEnums.ts`

### æ¨¡æ‹Ÿå™¨æ¶æ„

é¡¹ç›®åŒ…å«ä¸€ä¸ªå®Œæ•´çš„æˆ˜æ–—æ¨¡æ‹Ÿå™¨ç³»ç»Ÿï¼š

- **æ ¸å¿ƒå¼•æ“**: äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œæ”¯æŒå®æ—¶å’Œæ‰¹é‡æ¨¡æ‹Ÿ
- **çŠ¶æ€æœº**: åŸºäº XState çš„è§’è‰²çŠ¶æ€ç®¡ç†
- **å·¥ä½œæµç¼–è¾‘å™¨**: å¯è§†åŒ–çš„å·¥ä½œæµè®¾è®¡å·¥å…·
- **3D æ¸²æŸ“**: åŸºäº Babylon.js çš„æˆ˜æ–—åœºæ™¯æ¸²æŸ“

### å¼€å‘å‘½ä»¤

- `pnpm dev` - å¯åŠ¨å¼€å‘æœåŠ¡å™¨
- `pnpm dev:setup` - é‡ç½®å¹¶å¯åŠ¨å¼€å‘ç¯å¢ƒ
- `pnpm dev:init` - åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ
- `pnpm db:studio` - æ‰“å¼€ Prisma Studio æŸ¥çœ‹æ•°æ®åº“
- `pnpm db:backup` - å¤‡ä»½æ•°æ®åº“
- `pnpm db:restore` - æ¢å¤æ•°æ®åº“å¤‡ä»½

> âš ï¸ æ³¨æ„ï¼šæ¯æ¬¡ä¿®æ”¹ `db/baseSchema.prisma` æˆ– `db/enums.ts` åï¼Œéƒ½éœ€è¦é‡æ–°æ‰§è¡Œ `pnpm dev:init`ã€‚

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. æ„å»ºåº”ç”¨ï¼š
```bash
pnpm package
```

2. éƒ¨ç½²ç”Ÿæˆçš„ `bundle.tar.gz`
