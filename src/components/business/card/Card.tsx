/**
 * 卡片组件
 * 是特化的dialog，用于展示单个数据
 */
import { Show, createEffect, createSignal, JSX, on } from "solid-js";
import { Motion, Presence } from "solid-motionone";
import { store } from "~/store";
import { OverlayScrollbarsComponent } from "overlayscrollbars-solid";

interface CardProps {
  title: string;
  index: number;
  total: number;
  children: JSX.Element;
  display: boolean;
}

const Decorate = (props: JSX.IntrinsicElements["svg"]) => {
  return (
    <svg width="44" height="47" viewBox="0 0 44 47" fill="none" xmlns="http://www.w3.org/2000/svg" {...props}>
      <path
        d="M9.42128 12.4651C9.31564 12.4651 9.24522 12.4299 9.1748 12.3242C9.10438 12.1834 9.13959 12.0073 9.28043 11.9369C11.9213 10.3524 15.1255 9.82425 18.1185 10.4933C18.2593 10.5285 18.3649 10.6693 18.3297 10.8454C18.2945 10.9862 18.1537 11.0919 17.9776 11.0566C15.1255 10.4228 12.0621 10.951 9.52691 12.4299C9.52691 12.4651 9.45649 12.4651 9.42128 12.4651Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M16.0058 13.7679C15.9706 13.7679 15.9354 13.7679 15.9002 13.7327C13.8931 12.8525 11.5692 12.8172 9.52692 13.6271C9.38608 13.6975 9.21002 13.6271 9.1396 13.451C9.06917 13.3102 9.1396 13.1341 9.31565 13.0637C11.4988 12.2186 13.9635 12.2539 16.1114 13.2046C16.2523 13.275 16.3227 13.451 16.2523 13.5919C16.2171 13.7327 16.1114 13.7679 16.0058 13.7679Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M14.2804 15.1059C14.2452 15.1059 14.1748 15.1059 14.1396 15.0707C13.5058 14.6834 12.6959 14.5073 11.6396 14.5778C10.9706 14.613 10.3015 14.7186 9.66774 14.9299C9.52689 14.9651 9.35084 14.8947 9.31563 14.7186C9.28042 14.5778 9.35084 14.4017 9.52689 14.3665C10.2311 14.1552 10.9353 14.0496 11.6396 14.0144C12.8368 13.944 13.7522 14.12 14.4565 14.5778C14.5973 14.6482 14.6325 14.8242 14.5621 14.9651C14.4565 15.0707 14.386 15.1059 14.2804 15.1059Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M12.6607 16.6552C12.5903 16.6552 12.5551 16.6552 12.5199 16.62C11.71 16.0918 10.6889 15.8805 9.7382 16.0214C9.59735 16.0566 9.4213 15.951 9.4213 15.7749C9.38609 15.6341 9.49172 15.458 9.66778 15.458C10.7593 15.282 11.9213 15.5284 12.872 16.127C13.0128 16.1975 13.0481 16.3735 12.9424 16.5144C12.8368 16.62 12.7312 16.6552 12.6607 16.6552Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M22.872 12.2257C22.4494 12.2257 22.0621 12.1553 21.71 12.0496C20.7593 11.7327 19.7734 10.8172 19.7734 9.65527C19.7734 8.77499 20.3368 7.96513 21.1466 7.64823C21.9565 7.33133 22.9424 7.57781 23.5058 8.24682C23.8227 8.63415 23.9987 9.19753 23.9283 9.69048C23.8579 10.113 23.6466 10.4299 23.3297 10.6412C22.6255 11.0989 21.6748 10.6764 21.2522 10.0426C21.1818 9.90175 21.217 9.72569 21.3227 9.65527C21.4635 9.58485 21.6396 9.62006 21.71 9.72569C21.9565 10.1482 22.5903 10.3947 22.9776 10.1482C23.1889 10.0074 23.2945 9.76091 23.2945 9.62006C23.3297 9.26795 23.2241 8.88062 23.0128 8.63414C22.5903 8.14119 21.8861 7.96513 21.2875 8.1764C20.6889 8.38767 20.2663 9.02147 20.2663 9.65527C20.2663 10.5356 21.041 11.2398 21.8156 11.4863C22.5551 11.7327 23.4353 11.6623 24.5269 11.3102C27.6959 10.2891 30.1607 7.68344 32.3086 5.00738C33.4001 3.63414 34.5621 2.15527 35.4424 0.500342C35.5128 0.359497 35.6889 0.324286 35.8297 0.394708C35.9706 0.465131 36.0058 0.641187 35.9353 0.782032C35.0199 2.47217 33.8579 3.98626 32.7311 5.3595C30.6184 8.14119 28.1184 10.8172 24.7734 11.8736C24.0691 12.1201 23.4706 12.2257 22.872 12.2257Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M7.87199 9.4369C7.73115 9.4369 7.62551 9.33127 7.5903 9.22564C7.41424 8.45099 7.06213 7.81718 6.60439 7.35944C6.53396 7.28902 6.42833 7.18338 6.35791 7.11296C5.65368 6.51437 4.94946 5.88057 4.10439 5.52845C3.96354 5.45803 3.89312 5.28197 3.96354 5.14113C4.03396 5.00028 4.21002 4.92986 4.35086 5.00028C5.26636 5.38761 6.00579 6.05662 6.71002 6.69042C6.81565 6.79606 6.92129 6.86648 6.99171 6.97211C7.55509 7.50028 7.94241 8.23972 8.11847 9.12C8.15368 9.26085 8.04805 9.4369 7.9072 9.47211C7.9072 9.4369 7.9072 9.4369 7.87199 9.4369Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M8.75228 8.20456C8.61143 8.20456 8.47059 8.09892 8.47059 7.95808C8.36495 6.86653 7.76636 5.81019 6.88608 5.14118C6.46355 4.82428 6.0058 4.64822 5.58326 4.64822C5.44242 4.64822 5.30157 4.50737 5.30157 4.36653C5.30157 4.22568 5.40721 4.08484 5.58326 4.08484C6.11143 4.08484 6.67481 4.29611 7.20298 4.68343C8.22411 5.42287 8.92834 6.65526 9.03397 7.92287C9.06918 8.06371 8.96355 8.20456 8.75228 8.20456C8.78749 8.20456 8.78749 8.20456 8.75228 8.20456Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M9.7382 7.28903C9.59736 7.28903 9.45651 7.18339 9.45651 7.04255C9.31567 6.09184 9.21003 5.28198 8.68186 4.7186C8.57623 4.61297 8.57623 4.43691 8.71708 4.33128C8.82271 4.22564 8.99877 4.22564 9.1044 4.36649C9.77341 5.10593 9.91426 6.19748 9.98468 6.97212C10.0199 7.11297 9.91426 7.25381 9.7382 7.28903Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M11.1466 6.8665C10.9706 6.83129 10.8297 6.72565 10.8649 6.5496C10.9353 5.91579 10.7945 5.24678 10.5128 4.6834C10.4424 4.54255 10.4776 4.3665 10.6184 4.29608C10.7593 4.22565 10.9353 4.26086 11.0058 4.40171C11.3579 5.07072 11.5339 5.84537 11.4283 6.62002C11.4283 6.76086 11.2875 6.8665 11.1466 6.8665Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M12.5198 6.47913C12.4846 6.47913 12.4846 6.47913 12.4494 6.47913C12.3086 6.44391 12.2029 6.30307 12.2381 6.12701C12.3438 5.66927 12.3086 5.1411 12.1677 4.68335C12.1325 4.54251 12.2029 4.36645 12.3438 4.33124C12.4846 4.29603 12.6607 4.36645 12.6959 4.50729C12.872 5.07068 12.9072 5.66927 12.8015 6.23265C12.7663 6.4087 12.6255 6.47913 12.5198 6.47913Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M6.34382 28.8735C6.20297 28.8735 6.06213 28.7326 6.06213 28.5918C6.02692 27.3946 5.32269 26.4087 4.61847 25.3523C4.37199 25.0354 4.16072 24.7538 3.94945 24.4368C3.24523 23.3101 2.8579 22.1833 2.78748 21.127C2.71706 19.8242 3.1748 18.5918 4.01987 17.8171C5.00579 16.9368 6.44945 16.7608 7.50579 17.3594C8.45649 17.9228 9.01987 19.1552 8.94945 20.458C8.87903 21.6552 8.38607 22.7467 7.89311 23.6622C7.82269 23.803 7.64663 23.8735 7.50579 23.7678C7.36494 23.6974 7.29452 23.5214 7.40016 23.3805C7.8579 22.5002 8.35086 21.4791 8.38607 20.3876C8.45649 19.296 7.99875 18.2749 7.2241 17.8171C6.41424 17.3242 5.18185 17.5002 4.4072 18.2045C3.66776 18.8735 3.28044 19.9298 3.35086 21.0566C3.38607 22.0073 3.7734 23.0284 4.44241 24.0847C4.61847 24.4016 4.82973 24.6833 5.041 25.0002C5.78044 26.0918 6.5903 27.2185 6.5903 28.5566C6.62551 28.7678 6.48466 28.8735 6.34382 28.8735Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M27.0269 8.52856C26.9917 8.52856 26.9213 8.52856 26.8861 8.52856C26.2171 8.49335 25.5833 8.07081 25.0903 7.36659C24.8086 6.97926 24.5974 6.52152 24.4213 6.09898C24.3509 5.92292 24.2805 5.74687 24.1748 5.57081C23.9636 5.18349 23.7523 4.79616 23.541 4.44405C22.6255 2.89475 21.6748 1.45109 20.1959 0.887713C19.3861 0.570811 18.4354 0.570811 17.6255 0.887713C16.6748 1.23983 15.7945 2.04968 15.2312 3.17645C14.6678 4.19757 14.3861 5.39476 14.1748 6.52152C14.1396 6.66236 13.9988 6.76799 13.8227 6.73278C13.6819 6.69757 13.5762 6.55673 13.6114 6.38067C13.8579 5.2187 14.1396 3.9863 14.7382 2.89475C15.4072 1.66236 16.3579 0.746867 17.4495 0.359544C18.4002 0.00743081 19.4565 0.00743081 20.4072 0.359544C22.0621 0.993346 23.0481 2.50743 24.034 4.16236C24.2452 4.54969 24.4917 4.93701 24.703 5.32433C24.7734 5.50039 24.879 5.67645 24.9495 5.8525C25.1255 6.27504 25.3368 6.66236 25.5833 7.01447C25.9706 7.54264 26.4636 7.89476 26.9565 7.92997C27.5199 7.96518 28.1185 7.61307 28.4354 7.0849C28.7171 6.59194 28.8579 5.99335 28.8579 5.18349C28.8579 3.70461 28.3297 2.22574 27.379 1.06377C27.2734 0.958135 27.3086 0.746868 27.4143 0.676445C27.5199 0.570811 27.7312 0.606022 27.8016 0.711656C28.8227 1.97926 29.3861 3.56377 29.3861 5.18349C29.3861 6.09898 29.21 6.80321 28.8579 7.36659C28.4706 8.07081 27.7664 8.52856 27.0269 8.52856Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M4.44239 46.5848C3.66774 46.5848 2.9283 46.3384 2.40013 45.8806C1.76633 45.3172 1.44943 44.4722 1.48464 43.4862C1.51985 41.8665 2.40013 40.3524 3.28041 39.12C3.45647 38.8736 3.63253 38.6271 3.80858 38.3806C4.51281 37.3595 5.28746 36.3384 5.67478 35.2116C6.23816 33.6623 6.02689 32.1482 5.1114 31.1975C5.00577 31.0919 5.00577 30.9158 5.1114 30.8102C5.21703 30.7045 5.39309 30.7045 5.49872 30.8102C6.55506 31.9369 6.80154 33.6623 6.16774 35.4229C5.7452 36.62 4.97056 37.7116 4.23112 38.7327C4.05506 38.9792 3.87901 39.2257 3.73816 39.4722C2.9283 40.6341 2.08323 42.0426 2.04802 43.5214C2.04802 44.0144 2.11844 44.8947 2.78746 45.4933C3.5621 46.1623 4.97056 46.2679 5.95647 45.6693C6.87196 45.1412 7.40013 44.12 7.40013 42.9933C7.40013 42.5707 7.2945 42.0074 6.83675 41.6905C6.44943 41.4088 5.85084 41.4088 5.35788 41.62C4.90013 41.8313 4.54802 42.2186 4.37196 42.7116C4.30154 42.8876 4.09027 43.4862 4.4776 43.8736C4.61844 44.0144 4.90013 44.0848 5.14661 44.0496C5.21703 44.0496 5.39309 43.9792 5.4283 43.8384C5.49872 43.6975 5.63957 43.6271 5.81563 43.6623C5.95647 43.7327 6.02689 43.8736 5.99168 44.0496C5.88605 44.3313 5.63957 44.5426 5.28746 44.613C4.86492 44.7186 4.37196 44.5778 4.09027 44.2961C3.66774 43.8736 3.5621 43.2045 3.8438 42.5003C4.09027 41.8665 4.54802 41.3384 5.14661 41.0919C5.81563 40.775 6.6607 40.8454 7.18887 41.2327C7.68182 41.5848 7.99872 42.2186 7.99872 42.9933C7.99872 44.2961 7.36492 45.4933 6.27337 46.1623C5.67478 46.444 5.07619 46.5848 4.44239 46.5848Z"
        fill="currentColor"
        fill-opacity="0.55"
      />
      <path
        d="M42.5 1C40.8333 3 36.2 7 31 7C24.5 7 28 6 19.5 6C11 6 6 9.5 2.5 16"
        stroke="currentColor"
        stroke-opacity="0.55"
        stroke-linecap="round"
      />
      <path
        d="M1.5 7C3.16667 8.16667 6.5 11.7 6.5 16.5C6.5 22.5 1 27 1 33.5C1 37 3.5 37.5 5.5 37.5C7.5 37.5 12 36 12 30.5C12 26.5 8.5 26.5 8 26.5C7.5 26.5 4.5 27 4.5 31.5C4.5 33 5.5 33 6 33C7 33 8 32 8 31"
        stroke="currentColor"
        stroke-opacity="0.55"
        stroke-linecap="round"
      />
    </svg>
  );
};

export const Card = (props: CardProps) => {
  // 计算旋转角度
  const [rotationAngle, setRotationAngle] = createSignal(0);

  createEffect(
    on(
      () => props.total,
      () => {
        setRotationAngle((props.total - props.index - 1) * 2);
        // console.log(props.index, props.total, props.title);
      },
    ),
  );

  return (
    <Presence exitBeforeEnter>
      <Show when={props.display}>
        <Motion.div
          animate={{
            transform: [`rotate(0deg)`, `rotate(${rotationAngle()}deg)`],
            opacity: [0, 1],
          }}
          exit={{
            transform: [`rotate(${rotationAngle()}deg)`, `rotate(0deg)`],
            opacity: [1, 0],
          }}
          transition={{ duration: store.settings.userInterface.isAnimationEnabled ? 0.3 : 0 }}
          class={`Card drop-shadow-dividing-color bg-primary-color fixed top-1/2 left-1/2 z-10 flex h-[70vh] w-full max-w-[90vw] -translate-x-1/2 -translate-y-1/2 flex-col items-center gap-3 rounded p-2 drop-shadow-2xl lg:max-w-[960px]`}
          style={{
            "z-index": props.index,
          }}
          onClick={(e) => e.stopPropagation()}
        >
          {/* 标题栏 */}
          <Show when={props.title}>
            <div class="CardTitle drop-shadow-dividing-color absolute -top-3 z-10 flex items-center drop-shadow-xl">
              <svg width="30" height="48" viewBox="0 0 30 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M13.8958 -6.07406e-07L-1.04907e-06 24L13.8958 48L29 48L29 -1.26763e-06L13.8958 -6.07406e-07Z"
                  fill="rgb(var(--primary))"
                />
                <path d="M19 6.99999L9 24L19 41L29 41L29 6.99999L19 6.99999Z" fill="currentColor" />
                <path
                  d="M29.5 3.49999L29.5 44.5L16.2109 44.5L16.0664 44.249L4.56641 24.249L4.42285 24L4.56641 23.751L16.0664 3.75097L16.2109 3.49999L29.5 3.49999Z"
                  stroke="currentColor"
                  stroke-opacity="0.55"
                />
              </svg>

              <div class="bg-primary-color z-10 -mx-px py-[3px]">
                <div class="border-boundary-color border-y py-[3px]">
                  <h1 class="text-primary-color bg-accent-color py-[3px] text-xl font-bold">{props.title}</h1>
                </div>
              </div>
              <svg width="30" height="48" viewBox="0 0 30 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M16.1042 -6.07406e-07L30 24L16.1042 48L0.999998 48L1 -1.26763e-06L16.1042 -6.07406e-07Z"
                  fill="rgb(var(--primary))"
                />
                <path
                  d="M0.500063 3.49999L0.500061 44.5L13.7891 44.5L13.9337 44.249L25.4337 24.249L25.5772 24L25.4337 23.751L13.9337 3.75097L13.7891 3.49999L0.500063 3.49999Z"
                  stroke="currentColor"
                  stroke-opacity="0.55"
                />
                <path d="M11 6.99999L21 24L11 41L1.00003 41L1.00003 6.99999L11 6.99999Z" fill="currentColor" />
              </svg>
            </div>
          </Show>

          {/* 内容区域 */}
          <div class="Content flex h-full w-full justify-center overflow-hidden">
            {/* 左侧装饰 */}
            <div class="Left z-10 flex flex-none flex-col">
              <Decorate class="" />
              <div class="Divider bg-boundary-color ml-1 h-full w-px flex-1 rounded-full"></div>
              <Decorate class="-scale-y-100" />
            </div>

            {/* 中间内容 */}
            <div class="Center -mx-10 flex w-full flex-1 flex-col items-center">
              {/* 上分割线 */}
              <div
                class="Divider bg-boundary-color mt-1 h-px w-full rounded-full"
                style={{
                  width: "calc(100% - 80px)",
                }}
              ></div>

              {/* 滚动内容区域 */}
              <OverlayScrollbarsComponent
                element="div"
                options={{ scrollbars: { autoHide: "scroll" } }}
                class="border-primary-color h-full w-full flex-1 rounded border-8"
              >
                <div class="Children mx-3 my-6 flex flex-col gap-3">{props.children}</div>
              </OverlayScrollbarsComponent>

              {/* 下分割线 */}
              <div
                class="Divider bg-boundary-color mb-1 h-px w-full rounded-full"
                style={{
                  width: "calc(100% - 80px)",
                }}
              ></div>
            </div>

            {/* 右侧装饰 */}
            <div class="Right z-10 flex flex-none -scale-x-100 flex-col">
              <Decorate />
              <div class="Divider bg-boundary-color ml-1 h-full w-px flex-1 rounded-full"></div>
              <Decorate class="-scale-y-100" />
            </div>
          </div>
        </Motion.div>
      </Show>
    </Presence>
  );
};
