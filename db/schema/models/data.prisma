// 世界
model world {
    id String @id

    name      String
    addresses address[]

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique

    updatedBy          account_update_data? @relation(fields: [updatedByAccountId], references: [accountId], onDelete: Cascade)
    updatedByAccountId String?
    createdBy          account_create_data? @relation(fields: [createdByAccountId], references: [accountId], onDelete: Cascade)
    createdByAccountId String?
}

// 地点
model address {
    id String @id

    name String
    type String // Enum ADDRESS_TYPE
    posX Int
    posY Int

    zones zone[]

    belongToWorld world  @relation(fields: [worldId], references: [id])
    worldId       String

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique

    updatedBy          account_update_data? @relation(fields: [updatedByAccountId], references: [accountId], onDelete: Cascade)
    updatedByAccountId String?
    createdBy          account_create_data? @relation(fields: [createdByAccountId], references: [accountId], onDelete: Cascade)
    createdByAccountId String?
}

// 活动
model activity {
    id   String @id
    name String

    zones   zone[]
    recipes recipe[]

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique

    updatedBy          account_update_data? @relation(fields: [updatedByAccountId], references: [accountId], onDelete: Cascade)
    updatedByAccountId String?
    createdBy          account_create_data? @relation(fields: [createdByAccountId], references: [accountId], onDelete: Cascade)
    createdByAccountId String?
}

// 地点区域
model zone {
    id String @id

    name        String
    rewardNodes Int?
    mobs        mob[]
    npcs        npc[]

    belongToActivity activity? @relation(fields: [activityId], references: [id])
    activityId       String?
    belongToAddress  address   @relation(fields: [addressId], references: [id])
    addressId        String

    link       zone[] @relation("linkZones")
    usedBylink zone[] @relation("linkZones")

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique

    updatedBy          account_update_data? @relation(fields: [updatedByAccountId], references: [accountId], onDelete: Cascade)
    updatedByAccountId String?
    createdBy          account_create_data? @relation(fields: [createdByAccountId], references: [accountId], onDelete: Cascade)
    createdByAccountId String?
}

model image {
    id String @id

    dataUrl String

    belongToNpc    npc?    @relation(fields: [belongToNpcId], references: [id], onDelete: Cascade)
    belongToNpcId  String?
    belongToWeapon weapon? @relation(fields: [weaponId], references: [itemId], onDelete: Cascade)
    weaponId       String?
    belongToArmor  armor?  @relation(fields: [armorId], references: [itemId], onDelete: Cascade)
    armorId        String?
    belongToOption option? @relation(fields: [optionId], references: [itemId], onDelete: Cascade)
    optionId       String?
    belongToMob    mob?    @relation(fields: [mobId], references: [id], onDelete: Cascade)
    mobId          String?
}

// 统计字段
model statistic {
    id String @id

    updatedAt       DateTime @updatedAt
    createdAt       DateTime
    usageTimestamps String[]
    viewTimestamps  String[]

    belongToMob       mob?
    belongToItem      item?
    belongToSkill     skill?
    belongToCharacter character?
    belongToSimulator simulator?
    belongToWorld     world?
    belongToAddress   address?
    belongToActivity  activity?
    belongToZone      zone?
    belongToRecipe    recipe?
    belongToNpc       npc?
    belongToTask      task?
}

// 怪物
model mob {
    id String @id

    name               String
    type               String // Enum MOB_TYPE
    captureable        Boolean
    baseLv             Int
    experience         Int
    partsExperience    Int
    initialElement     String // Enum ELEMENT_TYPE
    radius             Int
    maxhp              Int
    physicalDefense    Int
    physicalResistance Int
    magicalDefense     Int
    magicalResistance  Int
    criticalResistance Int
    avoidance          Int
    dodge              Int
    block              Int
    normalDefExp       Int
    physicDefExp       Int
    magicDefExp        Int
    actions            Json

    drops drop_item[]

    details     String?
    dataSources String

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique
    images      image[]

    usedByZones                zone[]
    usedByTaskKillRequirements task_kill_requirement[]
    usedByMembers              member[]
    usedByPlayerPets           player_pet[]

    updatedBy          account_update_data? @relation(fields: [updatedByAccountId], references: [accountId])
    updatedByAccountId String?
    createdBy          account_create_data? @relation(fields: [createdByAccountId], references: [accountId])
    createdByAccountId String?
    // FTS
}

// 道具
model item {
    id             String @id
    itemType       String // Enum ITEM_TYPE
    itemSourceType String // Enum ITEM_SOURCE_TYPE
    name           String

    dataSources String
    details     String?

    weapon     weapon?
    armor      armor?
    option     option?
    special    special?
    crystal    crystal?
    consumable consumable?
    material   material?

    recipe recipe?

    usedByDropItems    drop_item[]
    usedByRewardItems  task_reward[]
    usedByTaskRequires task_collect_require[]

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique

    updatedBy          account_update_data? @relation(fields: [updatedByAccountId], references: [accountId], onDelete: Cascade)
    updatedByAccountId String?
    createdBy          account_create_data? @relation(fields: [createdByAccountId], references: [accountId], onDelete: Cascade)
    createdByAccountId String?

    // 道具可以作为其他道具的配方原料
    usedByIngredient recipe_ingredient[]
}

// 素材物品
model material {
    name    String
    type    String // Enum MATERIAL_TYPE
    ptValue Int
    price   Int

    belongToItem item   @relation(fields: [itemId], references: [id], onDelete: Cascade)
    itemId       String @id
}

// 消耗品
model consumable {
    name           String
    type           String // Enum CONSUMABLE_TYPE
    effectDuration Int
    effects        String[]

    belongToItem item   @relation(fields: [itemId], references: [id], onDelete: Cascade)
    itemId       String @id

    usedByCharacters character[]
}

// 锻晶
model crystal {
    name      String
    type      String // Enum CRYSTAL_TYPE
    modifiers String[]

    front crystal[] @relation("frontRelation")
    back  crystal[] @relation("backRelation")

    belongToItem item   @relation(fields: [itemId], references: [id], onDelete: Cascade)
    itemId       String @id

    usedByWeapons        weapon[]
    usedByPlayerWeapons  player_weapon[]
    usedByArmors         armor[]
    usedByPlayerArmors   player_armor[]
    usedByOptions        option[]
    usedByPlayerOptions  player_option[]
    usedBySpecials       special[]
    usedByPlayerSpecials player_special[]

    usedByFronts crystal[] @relation("frontRelation")
    usedByBacks  crystal[] @relation("backRelation")
}

// 武器
model weapon {
    name            String
    type            String // Enum WEAPON_TYPE
    elementType     String // Enum ELEMENT_TYPE
    baseAbi         Int
    stability       Int
    defaultCrystals crystal[]
    modifiers       String[]
    colorA          Int
    colorB          Int
    colorC          Int
    images          image[]

    usedByPlayerWeapons player_weapon[]

    belongToItem item   @relation(fields: [itemId], references: [id], onDelete: Cascade)
    itemId       String @id
}

// 防具
model armor {
    name            String
    baseAbi         Int
    defaultCrystals crystal[]
    modifiers       String[]
    colorA          Int
    colorB          Int
    colorC          Int
    images          image[]

    usedByPlayerArmors player_armor[]

    belongToItem item   @relation(fields: [itemId], references: [id], onDelete: Cascade)
    itemId       String @id
}

// 追加装备
model option {
    name            String
    baseAbi         Int
    defaultCrystals crystal[]
    modifiers       String[]
    colorA          Int
    colorB          Int
    colorC          Int
    images          image[]

    usedByPlayerOptions player_option[]

    belongToItem item   @relation(fields: [itemId], references: [id], onDelete: Cascade)
    itemId       String @id
}

// 特殊装备
model special {
    name            String
    baseAbi         Int
    defaultCrystals crystal[]
    modifiers       String[]

    usedByPlayerSpecials player_special[]

    belongToItem item   @relation(fields: [itemId], references: [id], onDelete: Cascade)
    itemId       String @id
}

// 配方
model recipe {
    id String @id

    recipeEntries recipe_ingredient[]

    belongToItem item   @relation(fields: [itemId], references: [id], onDelete: Cascade)
    itemId       String @unique

    belongToActivity activity? @relation(fields: [activityId], references: [id])
    activityId       String?

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique

    updatedBy          account_update_data? @relation(fields: [updatedByAccountId], references: [accountId], onDelete: Cascade)
    updatedByAccountId String?
    createdBy          account_create_data? @relation(fields: [createdByAccountId], references: [accountId], onDelete: Cascade)
    createdByAccountId String?
}

// 配方项
model recipe_ingredient {
    id String @id

    count  Int
    type   String // Enum RECIPE_INGREDIENT_TYPE
    item   item?   @relation(fields: [itemId], references: [id])
    itemId String?

    // 从属于配方
    belongTorecipe recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)
    recipeId       String
}

// 掉落物
model drop_item {
    id String @id

    item            item   @relation(fields: [itemId], references: [id])
    itemId          String
    probability     Int
    relatedPartType String // Enum BOSS_PART_TYPE
    relatedPartInfo String
    breakRewardType String // Enum BOSS_PART_BREAK_REWARD_TYPE

    belongToMob   mob    @relation(fields: [belongToMobId], references: [id], onDelete: Cascade)
    belongToMobId String
}

// NPC
model npc {
    id String @id

    name String

    tasks  task[]
    images image[]

    belongToZone zone   @relation(fields: [zoneId], references: [id])
    zoneId       String

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique

    updatedBy          account_update_data? @relation(fields: [updatedByAccountId], references: [accountId], onDelete: Cascade)
    updatedByAccountId String?
    createdBy          account_create_data? @relation(fields: [createdByAccountId], references: [accountId], onDelete: Cascade)
    createdByAccountId String?
}

// 任务
model task {
    id String @id

    lv          Int
    name        String
    type        String // Enum TASK_TYPE
    description String
    kills       task_kill_requirement[]
    requires    task_collect_require[]
    rewards     task_reward[]

    belongToNpc   npc    @relation(fields: [belongToNpcId], references: [id])
    belongToNpcId String

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique

    updatedBy          account_update_data? @relation(fields: [updatedByAccountId], references: [accountId], onDelete: Cascade)
    updatedByAccountId String?
    createdBy          account_create_data? @relation(fields: [createdByAccountId], references: [accountId], onDelete: Cascade)
    createdByAccountId String?
}

// 任务击杀要求
model task_kill_requirement {
    id String @id

    mob   mob    @relation(fields: [mobId], references: [id])
    mobId String
    count Int

    belongToTask   task   @relation(fields: [belongToTaskId], references: [id], onDelete: Cascade)
    belongToTaskId String
}

// 任务收集需求项
model task_collect_require {
    id String @id

    count  Int
    item   item   @relation(fields: [itemId], references: [id])
    itemId String

    belongTorecipe task   @relation(fields: [belongToTaskId], references: [id], onDelete: Cascade)
    belongToTaskId String
}

// 任务奖励
model task_reward {
    id String @id

    type        String // Enum TASK_REWARD_TYPE
    value       Int
    probability Int
    item        item?   @relation(fields: [itemId], references: [id]) // 仅当type为item时生效
    itemId      String?

    belongToTask   task   @relation(fields: [belongToTaskId], references: [id], onDelete: Cascade)
    belongToTaskId String
}

model skill {
    id String @id

    treeType     String // Enum SKILL_TREE_TYPE
    posX         Int
    posY         Int
    tier         Int
    name         String
    isPassive    Boolean
    chargingType String // Enum SKILL_CHARGING_TYPE
    distanceType String // Enum SKILL_DISTANCE_TYPE
    targetType   String // Enum SKILL_TARGET_TYPE
    effects      skill_effect[]

    details     String
    dataSources String

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique

    usedByCharacterSkills character_skill[]

    updatedBy          account_update_data? @relation(fields: [updatedByAccountId], references: [accountId], onDelete: Cascade)
    updatedByAccountId String?
    createdBy          account_create_data? @relation(fields: [createdByAccountId], references: [accountId], onDelete: Cascade)
    createdByAccountId String?
}

// 技能变体(适配特定装备组合的技能实际效果)
model variant {
    id String @id

    equipPattern      String
    hpCost            String?
    mpCost            String?
    description       String
    activeEffect      Json /// ZOD EffectTreeSchema
    passiveEffects    Json[] /// ZOD EffectTreeSchema
    buffs             Json[] /// ZOD EffectTreeSchema
    elementLogic      String
    castingRange      String
    effectiveRange    Int
    motionFixed       String
    motionModified    String
    chantingFixed     String
    chantingModified  String
    reservoirFixed    String
    reservoirModified String
    startupFrames     String
    logic             Json /// ZOD SkillEffectLogicSchema
    details           String?

    belongToSkill   skill  @relation(fields: [belongToskillId], references: [id], onDelete: Cascade)
    belongToskillId String
}

// 模拟器内容 ----------------------------------------------------------------------------------------------

// 资产归属和操作实体
model player {
    id String @id

    name  String
    useIn String

    pets       player_pet[]
    weapons    player_weapon[]
    armors     player_armor[]
    options    player_option[]
    specials   player_special[]
    avatars    avatar[]
    characters character[]

    belongToAccount   account @relation(fields: [belongToAccountId], references: [id], onDelete: Cascade)
    belongToAccountId String

    usedByMembers member[]
}

// 玩家自定义武器
model player_weapon {
    id String @id

    name        String
    type        String // Enum WEAPON_TYPE
    elementType String // Enum ELEMENT_TYPE
    baseAbi     Int
    stability   Int
    extraAbi    Int
    template    weapon?   @relation(fields: [templateId], references: [itemId])
    templateId  String?
    refinement  Int
    modifiers   String[]
    crystals    crystal[]

    belongToPlayer   player @relation(fields: [belongToPlayerId], references: [id], onDelete: Cascade)
    belongToPlayerId String

    usedByMainHand character[] @relation("weapon")
    usedBySubHand  character[] @relation("subWeapon")
}

// 玩家自定义身体装备
model player_armor {
    id String @id

    name       String
    baseAbi    Int
    extraAbi   Int
    ability    String // Enum PLAYER_ARMOR_ABILITY_TYPE
    template   armor?    @relation(fields: [templateId], references: [itemId])
    templateId String?
    refinement Int
    modifiers  String[]
    crystals   crystal[]

    belongToPlayer   player @relation(fields: [belongToPlayerId], references: [id], onDelete: Cascade)
    belongToPlayerId String

    usedBy character[]
}

// 玩家自定义追加装备
model player_option {
    id String @id

    name       String
    baseAbi    Int
    extraAbi   Int
    template   option?   @relation(fields: [templateId], references: [itemId])
    templateId String
    refinement Int
    modifiers  String[]
    crystals   crystal[]

    belongToPlayer   player @relation(fields: [belongToPlayerId], references: [id], onDelete: Cascade)
    belongToPlayerId String

    usedBy character[]
}

// 玩家自定义特殊装备
model player_special {
    id String @id

    name       String
    baseAbi    Int
    extraAbi   Int
    template   special?  @relation(fields: [templateId], references: [itemId])
    templateId String
    modifiers  String[]
    crystals   crystal[]

    belongToPlayer   player @relation(fields: [belongToPlayerId], references: [id], onDelete: Cascade)
    belongToPlayerId String

    usedBy character[]
}

// 自定义宠物
model player_pet {
    id String @id

    template    mob    @relation(fields: [templateId], references: [id])
    templateId  String
    name        String
    pStr        Int
    pInt        Int
    pVit        Int
    pAgi        Int
    pDex        Int
    str         Int
    int         Int
    vit         Int
    agi         Int
    dex         Int
    weaponType  String // Enum MAIN_WEAPON_TYPE
    personaType String // Enum PET_PERSONA_TYPE
    type        String // Enum PET_TYPE
    weaponAtk   Int
    generation  Int
    maxLv       Int

    belongToPlayer   player @relation(fields: [belongToPlayerId], references: [id], onDelete: Cascade)
    belongToPlayerId String
}

// 时装
model avatar {
    id String @id

    name      String
    type      String // Enum AVATAR_TYPE
    modifiers String[]

    belongToPlayer   player @relation(fields: [belongToPlayerId], references: [id], onDelete: Cascade)
    belongToPlayerId String

    usedByCharacters character[]
}

// 机体
model character {
    id   String @id
    name String

    lv                Int
    str               Int
    int               Int
    vit               Int
    agi               Int
    dex               Int
    personalityType   String // Enum CHARACTER_PERSONALITY_TYPE
    personalityValue  Int
    weapon            player_weapon?    @relation("weapon", fields: [weaponId], references: [id])
    weaponId          String?
    subWeapon         player_weapon?    @relation("subWeapon", fields: [subWeaponId], references: [id])
    subWeaponId       String?
    armor             player_armor?     @relation(fields: [armorId], references: [id])
    armorId           String?
    option            player_option?    @relation(fields: [optionId], references: [id])
    optionId          String?
    special           player_special?   @relation(fields: [specialId], references: [id])
    specialId         String?
    avatars           avatar[]
    cooking           String[]
    modifiers         String[]
    skills            character_skill[]
    partnerSkillAId   String?
    partnerSkillAType String // Enum PARTNER_SKILL_TYPE
    partnerSkillBId   String?
    partnerSkillBType String // Enum PARTNER_SKILL_TYPE
    consumables       consumable[]
    combos            combo[]
    belongToPlayer    player            @relation(fields: [belongToPlayerId], references: [id], onDelete: Cascade)
    belongToPlayerId  String

    details String?

    usedByMercenary mercenary?

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique
}

// 角色习得技能
model character_skill {
    id String @id

    lv         Int
    isStarGem  Boolean
    template   skill   @relation(fields: [templateId], references: [id])
    templateId String

    usedByComboSteps combo_step[]

    belongToCharacter   character @relation(fields: [belongToCharacterId], references: [id], onDelete: Cascade)
    belongToCharacterId String
}

// 连击
model combo {
    id String @id

    disable Boolean
    name    String
    content combo_step[]

    belongToCharacter   character @relation(fields: [belongToCharacterId], references: [id], onDelete: Cascade)
    belongToCharacterId String
}

// 连击步骤
model combo_step {
    id String @id

    type             String // Enum COMBO_STEP_TYPE
    characterSkill   character_skill @relation(fields: [characterSkillId], references: [id])
    characterSkillId String

    belongToCombo   combo  @relation(fields: [belongToComboId], references: [id], onDelete: Cascade)
    belongToComboId String
}

// 佣兵
model mercenary {
    type       String // Enum MERCENARY_TYPE
    template   character @relation(fields: [templateId], references: [id], onDelete: Cascade)
    templateId String    @id

    skillAId   String
    skillAType String // Enum PARTNER_SKILL_TYPE
    skillBId   String
    skillBType String // Enum PARTNER_SKILL_TYPE

    usedByMemberPartners    member[] @relation("partner")
    usedByMemberMercenaries member[] @relation("mercenary")
}

// 模拟器
model simulator {
    id String @id

    name  String
    campA team[] @relation("campA")
    campB team[] @relation("campB")

    details String?

    statistic   statistic @relation(fields: [statisticId], references: [id])
    statisticId String    @unique

    updatedBy          account_update_data? @relation(fields: [updatedByAccountId], references: [accountId], onDelete: Cascade)
    updatedByAccountId String?
    createdBy          account_create_data? @relation(fields: [createdByAccountId], references: [accountId], onDelete: Cascade)
    createdByAccountId String?
}

// 队伍
model team {
    id String @id

    name    String?
    members member[]
    gems    String[]

    usedByCampAs simulator[] @relation("campA")
    usedByCampBs simulator[] @relation("campB")
}

// 队伍成员
model member {
    id String @id

    name              String
    sequence          Int
    type              String // Enum MEMBER_TYPE
    player            player?    @relation(fields: [playerId], references: [id])
    playerId          String?
    partner           mercenary? @relation("partner", fields: [partnerId], references: [templateId])
    partnerId         String?
    mercenary         mercenary? @relation("mercenary", fields: [mercenaryId], references: [templateId])
    mercenaryId       String?
    mob               mob?       @relation(fields: [mobId], references: [id])
    mobId             String?
    mobDifficultyFlag String // Enum MOB_DIFFICULTY_FLAG
    actions           Json

    belongToTeam   team   @relation(fields: [belongToTeamId], references: [id], onDelete: Cascade)
    belongToTeamId String
}
